---
title: "ã€Flutterã€‘ã‚¢ãƒ—ãƒªå†…ã«Appleã®åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["flutter", "ios", "map", "dart"]
published: true
---

# æ¦‚è¦

flutter ã§ã¯ google å…¬å¼ãŒå‡ºã—ã¦ã„ã‚‹[google_maps_flutter](https://pub.dev/packages/google_maps_flutter)ãŒã‚ã‚Šã€æ¤œç´¢ã™ã‚‹ã¨ã»ã¨ã‚“ã© google ãƒãƒƒãƒ—é–¢é€£ã®å°å…¥è¨˜äº‹ãŒæº¢ã‚Œã¦ã„ã¾ã™ã€‚

ã—ã‹ã—ã€google ãƒãƒƒãƒ—ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†å ´åˆ API ã®ç™»éŒ²ãƒ»å–å¾—ã¨ã„ã£ãŸã€é¢å€’ãã•ã•ã‚„ API ã®æœŸé™åˆ‡ã‚Œãªã©ç®¡ç†ã®ã‚³ã‚¹ãƒˆãªã©ã‚‚ã‹ã‹ã‚Šã¾ã™ã€‚
Android ã®å ´åˆã¯ãã†ã—ãŸç™»éŒ²ã‚’çµŒã¦ã€google ãƒãƒƒãƒ—ã‚’å°å…¥ã™ã‚‹ã‚“ã§ã™ãŒã€ã¾ãšã¯ iOS ç‰ˆã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã—ãŸã„å ´åˆã€Apple ã®ãƒãƒƒãƒ—ã‚’ä½¿ã£ãŸã»ã†ãŒ APIkey ã®å–å¾—ã¨ã„ã£ãŸç…©ã‚ã—ã•ã‚„åˆ©ç”¨æ–™é‡‘ãªã©ã¨è€ƒãˆãªãã¦ã‚‚ã„ã„ã¨ã„ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

ä»Šå›ã®è¨˜äº‹ã§ã¯ãã†ã—ãŸå°å…¥ã‚³ã‚¹ãƒˆã‚’ã‹ã‘ãšã«ãƒãƒƒãƒ—ã‚’å°å…¥ã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚

## æƒ³å®šèª­è€…

- ã¾ãšã¯ iOS ã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã“ã¨ã‚’ç›®æ¨™ã¨ã—ã¦ã„ã‚‹äºº
- APIkey ã®ç™»éŒ²ãƒ»å–å¾—ã¨ã„ã£ãŸã“ã¨ã‚’é¿ã‘ãŸã„äºº
- åˆ©ç”¨æ–™é‡‘ãªã©ã‚’è€ƒãˆãŸããªã„äºº

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç´¹ä»‹

**Apple Maps Widget ã‚’æä¾›ã™ã‚‹ Flutter ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**
[apple_maps_flutter](https://pub.dev/packages/apple_maps_flutter#sample-usage)

**Google Maps Widget ã‚’æä¾›ã™ã‚‹ Flutter ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**
[google_maps_flutter](https://pub.dev/packages/google_maps_flutter)

**Android ã¨ iOS ã®ä¸¡ãƒ‡ãƒã‚¤ã‚¹ã«ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒãƒƒãƒ—ã‚’æä¾›ã™ã‚‹ Flutter ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸**
[platform_maps_flutter](https://pub.dev/packages/platform_maps_flutter)

ä»Šå›ã¯å°†æ¥çš„ã«ä¸¡ãƒ‡ãƒã‚¤ã‚¹ã«ãƒãƒƒãƒ—ã‚’å°å…¥ã™ã‚‹ã“ã¨ã‚’æƒ³å®šã—ã€3 ç•ªç›®ã®[platform_maps_flutter](https://pub.dev/packages/platform_maps_flutter)ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ãŸå®Ÿè£…ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

# ç’°å¢ƒ

```
>flutter doctor -v
[âœ“] Flutter (Channel stable, 2.5.3, on macOS 11.4 20F71 darwin-x64, locale ja-JP)
    â€¢ Flutter version 2.5.3 at /Users/tamakikyou/fvm/versions/2.5.3
    â€¢ Upstream repository https://github.com/flutter/flutter.git
    â€¢ Framework revision 18116933e7 (3 months ago), 2021-10-15 10:46:35 -0700
    â€¢ Engine revision d3ea636dc5
    â€¢ Dart version 2.14.4

[âœ“] Android toolchain - develop for Android devices (Android SDK version 31.0.0)
    â€¢ Android SDK at /Users/tamakikyou/Library/Android/sdk
    â€¢ Platform android-31, build-tools 31.0.0
    â€¢ Java binary at: /Applications/Android Studio.app/Contents/jre/Contents/Home/bin/java
    â€¢ Java version OpenJDK Runtime Environment (build 11.0.10+0-b96-7281165)
    â€¢ All Android licenses accepted.

[âœ“] Xcode - develop for iOS and macOS
    â€¢ Xcode at /Applications/Xcode.app/Contents/Developer
    â€¢ Xcode 13.1, Build version 13A1030d
    â€¢ CocoaPods version 1.10.2
```

# å®Ÿè£…

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¿½åŠ 

```yaml: pubpec.yaml
dependencies:
  platform_maps_flutter: ^1.0.2
```

## Info.plist ã®ç·¨é›†

```plist: Info.plist
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <!-- ... -->

  // platformViewã‚’ä½¿ã†ãŸã‚ã®ãƒ•ãƒ©ã‚° æŒ‡å®šã—ãªãã¦ã‚‚è‰¯ã„ã‹ã‚‚ï¼Ÿ
  <!-- <key>io.flutter.embedded_views_preview</key>
  <true/> -->

  //ä½ç½®æƒ…å ±ã‚’ä½¿ã„ã¾ã™ã¨ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®èª¬æ˜æ–‡
  <key>NSLocationAlwaysAndWhenInUseUsageDescription</key>
  <string>This app requires userâ€™s location for better user experience.</string>
</dict>
</plist>
```

## PlatformMap Widget

```dart
  class MyHomePage extends StatefulWidget {
    MyHomePage({Key? key}) : super(key: key);

    @override
    _MyHomePageState createState() => _MyHomePageState();
  }

  class HomePage extends StatelessWidget {
    @override
    Widget build(BuildContext context) {
      return Scaffold(
        body: SizedBox(
              height: 300,
              child: PlatformMap(
                // ãƒãƒƒãƒ—ã®ã‚«ãƒ¡ãƒ©ã®åˆæœŸå€¤
                initialCameraPosition: const CameraPosition(
                  // åœ°ç†æƒ…å ±
                  target: LatLng(47.6, 8.8796),
                  zoom: 16,
                ),

                markers: <Marker>{
                  Marker(
                    // ãƒãƒ¼ã‚«ãƒ¼ID ãƒªã‚¹ãƒˆã®ä¸­ã§ä¸€æ„ã§ã‚ã‚Œã°ã„ã„
                    markerId: MarkerId('marker_1'),
                    // åœ°ç†æƒ…å ±
                    position: const LatLng(47.6, 8.8796),
                    // ã‚¿ãƒƒãƒ—ã‚¤ãƒ™ãƒ³ãƒˆ
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¿ãƒƒãƒ—å‡¦ç†ã§ã¯ã€ãƒãƒƒãƒ—ã‚’ãƒãƒ¼ã‚«ãƒ¼ã®ä¸­å¤®ã«é…ç½®ã—ã€ãƒãƒ¼ã‚«ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚
                    consumeTapEvents: true,
                    // æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ã‚¨ã‚­ã‚¹ãƒˆãƒ©ãƒ™ãƒ«
                    infoWindow: const InfoWindow(
                      title: 'PlatformMarker',
                      snippet: "Hi I'm a Platform Marker",
                    ),
                    onTap: () {
                      print("Marker tapped");
                    },
                  ),
                },
                // ç¾åœ¨åœ°ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è¡¨ç¤º 
                myLocationEnabled: true,
                // ãƒã‚¤ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹ãƒ»ç„¡åŠ¹ã‚’è¨­å®šã—ã¾ã™ã€‚ãƒã‚¤ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½ç½®ãŒç§»å‹•ã™ã‚‹ã‚ˆã†ã«ã‚«ãƒ¡ãƒ©ã‚’ç§»å‹•ã•ã›ã¾ã™ã€‚
                myLocationButtonEnabled: true,
                // [GoogleMap] ãŒã‚¿ãƒƒãƒ—ã•ã‚Œã‚‹åº¦ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚ 
                onTap: (location) => print('onTap: $location'),
                // ã‚«ãƒ¡ãƒ©ãŒç§»å‹•ã—ç¶šã‘ã‚‹ãŸã³ã«å‘¼ã³å‡ºã•ã‚Œã‚‹
                onCameraMove: (cameraUpdate) =>
                    print('onCameraMove: $cameraUpdate'),
                // åœ°å›³ãŒå›è»¢ã—ãŸã¨ãã«ã‚³ãƒ³ãƒ‘ã‚¹ã‚’è¡¨ç¤º
                compassEnabled: true,
                // ãƒãƒƒãƒ—ãŒä½¿ç”¨å¯èƒ½ã«ãªã£ãŸã¨ãã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ãƒ¡ã‚½ãƒƒãƒ‰
                onMapCreated: (controller) {
                  Future<dynamic>.delayed(const Duration(seconds: 2)).then(
                    (dynamic _) {
                      controller.animateCamera(
                        CameraUpdate.newCameraPosition(
                          const CameraPosition(
                            bearing: 270.0,
                            target: LatLng(51.5160895, -0.1294527),
                            tilt: 30.0,
                            zoom: 18,
                          ),
                        ),
                      );
                    },
                  );
                },
              ),
            ),
      );
    }
  }
```

## åŸæ–‡

```dart
class PlatformMap extends StatefulWidget {
  const PlatformMap({
    Key? key,
    required this.initialCameraPosition,
    this.onMapCreated,
    this.gestureRecognizers = const <Factory<OneSequenceGestureRecognizer>>{},
    this.compassEnabled = true,
    this.mapType = MapType.normal,
    this.minMaxZoomPreference = MinMaxZoomPreference.unbounded,
    this.rotateGesturesEnabled = true,
    this.scrollGesturesEnabled = true,
    this.zoomControlsEnabled = true,
    this.zoomGesturesEnabled = true,
    this.tiltGesturesEnabled = true,
    this.myLocationEnabled = false,
    this.myLocationButtonEnabled = false,
    this.padding = const EdgeInsets.all(0),
    this.trafficEnabled = false,
    this.markers = const <Marker>{},
    this.polygons = const <Polygon>{},
    this.polylines = const <Polyline>{},
    this.circles = const <Circle>{},
    this.onCameraMoveStarted,
    this.onCameraMove,
    this.onCameraIdle,
    this.onTap,
    this.onLongPress,
  }) : super(key: key);

  /// Callback method for when the map is ready to be used.
  ///
  /// Used to receive a [GoogleMapController] for this [GoogleMap].
  final MapCreatedCallback? onMapCreated;

  /// The initial position of the map's camera.
  final CameraPosition initialCameraPosition;

  /// True if the map should show a compass when rotated.
  final bool compassEnabled;

  /// Type of map tiles to be rendered.
  final MapType mapType;

  /// Preferred bounds for the camera zoom level.
  ///
  /// Actual bounds depend on map data and device.
  final MinMaxZoomPreference minMaxZoomPreference;

  /// True if the map view should respond to rotate gestures.
  final bool rotateGesturesEnabled;

  /// True if the map view should respond to scroll gestures.
  final bool scrollGesturesEnabled;

  /// True if the map view should show zoom controls. This includes two buttons
  /// to zoom in and zoom out. The default value is to show zoom controls.
  ///
  /// This is only supported on Android. And this field is silently ignored on iOS.
  final bool zoomControlsEnabled;

  /// True if the map view should respond to zoom gestures.
  final bool zoomGesturesEnabled;

  /// True if the map view should respond to tilt gestures.
  final bool tiltGesturesEnabled;

  /// Padding to be set on map. See https://developers.google.com/maps/documentation/android-sdk/map#map_padding for more details.
  final EdgeInsets padding;

  /// Markers to be placed on the map.
  final Set<Marker> markers;

  /// Polygons to be placed on the map.
  final Set<Polygon> polygons;

  /// Polylines to be placed on the map.
  final Set<Polyline> polylines;

  /// Circles to be placed on the map.
  final Set<Circle> circles;

  /// Called when the camera starts moving.
  ///
  /// This can be initiated by the following:
  /// 1. Non-gesture animation initiated in response to user actions.
  ///    For example: zoom buttons, my location button, or marker clicks.
  /// 2. Programmatically initiated animation.
  /// 3. Camera motion initiated in response to user gestures on the map.
  ///    For example: pan, tilt, pinch to zoom, or rotate.
  final VoidCallback? onCameraMoveStarted;

  /// Called repeatedly as the camera continues to move after an
  /// onCameraMoveStarted call.
  ///
  /// This may be called as often as once every frame and should
  /// not perform expensive operations.
  final CameraPositionCallback? onCameraMove;

  /// Called when camera movement has ended, there are no pending
  /// animations and the user has stopped interacting with the map.
  final VoidCallback? onCameraIdle;

  /// Called every time a [GoogleMap] is tapped.
  final ArgumentCallback<LatLng>? onTap;

  /// Called every time a [GoogleMap] is long pressed.
  final ArgumentCallback<LatLng>? onLongPress;

  /// True if a "My Location" layer should be shown on the map.
  ///
  /// This layer includes a location indicator at the current device location,
  /// as well as a My Location button.
  /// * The indicator is a small blue dot if the device is stationary, or a
  /// chevron if the device is moving.
  /// * The My Location button animates to focus on the user's current location
  /// if the user's location is currently known.
  ///
  /// Enabling this feature requires adding location permissions to both native
  /// platforms of your app.
  /// * On Android add either
  /// `<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />`
  /// or `<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION" />`
  /// to your `AndroidManifest.xml` file. `ACCESS_COARSE_LOCATION` returns a
  /// location with an accuracy approximately equivalent to a city block, while
  /// `ACCESS_FINE_LOCATION` returns as precise a location as possible, although
  /// it consumes more battery power. You will also need to request these
  /// permissions during run-time. If they are not granted, the My Location
  /// feature will fail silently.
  /// * On iOS add a `NSLocationWhenInUseUsageDescription` key to your
  /// `Info.plist` file. This will automatically prompt the user for permissions
  /// when the map tries to turn on the My Location layer.
  final bool myLocationEnabled;

  /// Enables or disables the my-location button.
  ///
  /// The my-location button causes the camera to move such that the user's
  /// location is in the center of the map. If the button is enabled, it is
  /// only shown when the my-location layer is enabled.
  ///
  /// By default, the my-location button is enabled (and hence shown when the
  /// my-location layer is enabled).
  ///
  /// See also:
  ///   * [myLocationEnabled] parameter.
  final bool myLocationButtonEnabled;

  /// Enables or disables the traffic layer of the map
  final bool trafficEnabled;

  /// Which gestures should be consumed by the map.
  ///
  /// It is possible for other gesture recognizers to be competing with the map on pointer
  /// events, e.g if the map is inside a [ListView] the [ListView] will want to handle
  /// vertical drags. The map will claim gestures that are recognized by any of the
  /// recognizers on this list.
  ///
  /// When this set is empty, the map will only handle pointer events for gestures that
  /// were not claimed by any other gesture recognizer.
  final Set<Factory<OneSequenceGestureRecognizer>> gestureRecognizers;
  @override
  _PlatformMapState createState() => _PlatformMapState();
}
```