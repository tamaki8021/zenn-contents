---
title: "expo„Åßfirebase-auth„ÅÆgoogle„É≠„Ç∞„Ç§„É≥„ÇíÂÆüË£Ö„Åô„Çã"
emoji: "üí≠"
type: "tech" # tech: ÊäÄË°ìË®ò‰∫ã / idea: „Ç¢„Ç§„Éá„Ç¢
topics: ["expo", "ReactNative", "firebase", "google", "firebaseAuth"]
published: false
---

# Âàù„ÇÅ„Å´

expo „ÅÆ„Éâ„Ç≠„É•„É°„É≥„Éà„Å´„ÅØËâ≤„ÄÖÊõ∏„ÅÑ„Å¶„ÅÇ„Çã„Çì„Åß„Åô„Åë„Å©„ÄÅÊ§úÁ¥¢„Åó„Åü„Çä„Åó„Å¶„ÇÇÂè§„ÅÑÊÉÖÂ†±„ÇÇÊ∑∑„Åò„Å£„Å¶„Åü„Çä„Åß„ÄÅÂÆüË£Ö„Å´Ëã¶Âä¥„Åó„Åü„ÅÆ firebase-auth „Çí‰Ωø„Å£„Åü google Ë™çË®º„ÅÆÂÆüË£Ö„Çí„ÇÑ„Å£„Å¶„ÅÑ„Åç„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

‰∫ãÂâç„Å´‰∏ãË®ò 2 ÁÇπ„ÅÆÁí∞Â¢É„ÅØ„Åß„Åç„Å¶„ÅÑ„ÇãÂâçÊèê„ÅßÈÄ≤„Åø„Åü„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ

- expo „ÅåÂà©Áî®„Åß„Åç„ÇãÁí∞Â¢É„Åß„ÅÇ„Çã
- firebase „ÅÆ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„Çí‰ΩúÊàêÊ∏à„Åø„Åß„ÅÇ„Çã

# firebase „Å®„ÅÆÊé•Á∂ö

[„Åì„Åì„ÅØ„Éâ„Ç≠„É•„É°„É≥„Éà„ÅÆÊâãÈ†Ü„Å´Âæì„Å£„Å¶Ë°å„ÅÑ„Åæ„Åô„ÄÇ](https://docs.expo.dev/guides/using-firebase/#firebase-sdk-setup)

firebase „ÅåÊèê‰æõ„Åô„Çã JavaScript SDK „Çí‰ΩøÁî®„Åô„Çã„ÅÆ„Åß firebase „Éë„ÉÉ„Ç±„Éº„Ç∏„Çí„Ç§„É≥„Çπ„Éà„Éº„É´„Åó„Åæ„Åô„ÄÇ

```
$ expo install firebase
```

firebase.ts(js)„Éï„Ç°„Ç§„É´„Çí‰ΩúÊàê„Åó„Å¶ firebase „ÅÆÁÆ°ÁêÜÁîªÈù¢‰∏ä„ÅÆ Firebase SDK „ÅÆËøΩÂä†„ÅßË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÅüÊé•Á∂öÊÉÖÂ†±„Çí„Ç≥„Éî„Éº&„Éö„Éº„Çπ„Å®„Åó„Åæ„Åô„ÄÇ

```ts:firebase.ts
import { initializeApp } from 'firebase/app';
import { getAuth } from 'firebase/auth';

// Optionally import the services that you want to use
//import {...} from "firebase/database";
//import {...} from "firebase/firestore";
//import {...} from "firebase/functions";
//import {...} from "firebase/storage";

// Initialize Firebase
const firebaseConfig = {
  apiKey: 'api-key',
  authDomain: 'project-id.firebaseapp.com',
  databaseURL: 'https://project-id.firebaseio.com',
  projectId: 'project-id',
  storageBucket: 'project-id.appspot.com',
  messagingSenderId: 'sender-id',
  appId: 'app-id',
  measurementId: 'G-measurement-id',
};

export const firebaseApp = initializeApp(firebaseConfig);
export const firebaseAuth = getAuth(firebaseApp)
```

# google „É≠„Ç∞„Ç§„É≥Áî®„ÅÆ„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅÆËøΩÂä†„ÉªË®≠ÂÆö

ÊúÄÂàù„ÅØËâ≤„ÄÖ„Å™Ë®ò‰∫ã„Åß„ÇÇ‰Ωø„Çè„Çå„Å¶„ÅÑ„Åü[expo-google-sign-in](https://github.com/expo/expo-google-sign-in)„Å®„ÅÑ„ÅÜ„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí‰Ωø„Åä„ÅÜ„Å®„Åó„Åü„ÅÆ„Åß„Åô„Åå„ÄÅÈùûÊé®Â•®„Å´„Å™„Å£„Å¶„ÅÑ„Åæ„Åó„ÅüÔºâ

„Å™„ÅÆ„Åß[@react-native-google-signin/google-signin](https://github.com/react-native-google-signin/google-signin#expo-installation)„ÅÆ„Éë„ÉÉ„Ç±„Éº„Ç∏„Çí‰Ωø„Å£„Å¶ÂÆüË£Ö„Åó„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ

> „Åì„ÅÆ„Éë„ÉÉ„Ç±„Éº„Ç∏„ÅØ"Expo Go"„Ç¢„Éó„É™„Åß„ÅØ‰ΩøÁî®„Åß„Åç„Å™„ÅÑ„ÅÆ„Åß„Åæ„Å†„Ç´„Çπ„Çø„É†„Éç„Ç§„ÉÜ„Ç£„Éñ„Ç≥„Éº„Éâ„ÇíËøΩÂä†„Åó„Å¶„ÅÑ„Å™„ÅÑÊñπ„ÅØ„Ç´„Çπ„Çø„É†„Éç„Ç§„ÉÜ„Ç£„Éñ„Ç≥„Éº„Éâ„ÅÆËøΩÂä†„ÅåÂøÖË¶Å„Å®„Å™„Çä„Åæ„Åô„ÄÇ

## „Ç´„Çπ„Çø„É†„Éç„Ç§„ÉÜ„Ç£„Éñ„Ç≥„Éº„Éâ„ÅÆËøΩÂä†Ôºà„Åæ„Å†Ë°å„Å£„Å¶„ÅÑ„Å™„ÅÑÊñπÔºâ

ËøΩÂä†„ÅØÁ∞°Âçò„Åß‰∏ãË®ò„ÅÆ„Ç≥„Éû„É≥„Éâ„ÇíËøΩÂä†„Åó„Åü„ÅÑÁí∞Â¢É„Åî„Å®„Å´ÂÆüË°å„Åô„Çã„Å†„Åë„Åß„Åô„ÄÇ
[„Ç´„Çπ„Çø„É†„Éç„Ç§„ÉÜ„Ç£„Éñ„Ç≥„Éº„Éâ„ÅÆËøΩÂä†](https://docs.expo.dev/workflow/customizing/)

:::message
iOS „ÅØ Xcode „ÅÆ„ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´„ÅåÂøÖË¶Å„Åß„ÅÇ„Çä„ÄÅAndroid „ÅØ Android Studio „Å® Android SDK „ÅÆ„Ç§„É≥„Çπ„Éà„Éº„É´„ÅåÂøÖË¶Å„Å´„Å™„Çä„Åæ„Åô„ÄÇ
:::

```
# Android
$ expo run:android

# iOS
$ expo run:ios
```

## „Ç§„É≥„Çπ„Éà„Éº„É´

```
$ expo install @react-native-google-signin/google-signin
```

## iOS/Android „ÅÆ„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó

„Éâ„Ç≠„É•„É°„É≥„Éà„Å´Âæì„Å£„Å¶‰Ωø„ÅÜÁí∞Â¢ÉÂà•„Å´„Çª„ÉÉ„Éà„Ç¢„ÉÉ„Éó„ÇíË°å„ÅÑ„Åæ„Åô„ÄÇ
[iOS „ÅÆÊâãÈ†Ü](https://github.com/react-native-google-signin/google-signin/blob/master/docs/ios-guide.md)
[Android „ÅÆÊâãÈ†Ü](https://github.com/react-native-google-signin/google-signin/blob/master/docs/android-guide.md)

## config „ÅÆË®≠ÂÆö

`app.json`„Åæ„Åü„ÅØ`app.config.js`„Å´‰∏ãË®ò„ÅÆÂÜÖÂÆπ„ÇíËøΩÂä†

:::message
`app.config.js`„Éï„Ç°„Ç§„É´„ÅØ„Éá„Éï„Ç©„É´„Éà„Åß‰ΩúÊàê„Åï„Çå„Çã`app.json`„Éï„Ç°„Ç§„É´„ÅÆÊã°ÂºµÁî®„Å´‰ΩúÊàê„Åï„Çå„Çã„Éï„Ç°„Ç§„É´„Å®„ÅÑ„ÅÜ„Ç§„É°„Éº„Ç∏„Åß„Åô„ÄÇ
:::

```json:app.json
{
  "expo": {
    "android": {
      "googleServicesFile": "./google-services.json"
    },
    "ios": {
      "googleServicesFile": "./GoogleService-Info.plist"
    },
    "plugins": ["@react-native-google-signin/google-signin"]
  }
}
```

# „É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÅÆ‰ΩúÊàê

```tsx: loginScreen.tsx
import React from 'react';
import {
  View,
  TextInput,
  Text,
  TouchableOpacity,
  KeyboardAvoidingView,
} from 'react-native';
import { useAuthContext } from '../hooks/auth';

const LoginScreen = () => {
  const { googleSignIn } = useAuthContext();

  return (
     <SafeAreaView>
      <Text>„É≠„Ç∞„Ç§„É≥ÁîªÈù¢</Text>
      <Button onPress={googleSignIn} title={'google„É≠„Ç∞„Ç§„É≥'} />
    </SafeAreaView>
  );
};

export default LoginScreen;
```

## „Ç´„Çπ„Çø„É†„Éï„ÉÉ„ÇØ„Å®„Åó„Å¶„É≠„Ç∞„Ç§„É≥ÈÉ®ÂàÜ„ÇíÂÆüË£Ö

(createContext)[https://ja.reactjs.org/docs/context.html]„Çí‰Ωø„Å£„Å¶ state „ÇíÁÆ°ÁêÜ„Åó„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ

```tsx:src/hooks/auth.tsx
import { GoogleSignin } from '@react-native-google-signin/google-signin';
import {
  GoogleAuthProvider,
  onAuthStateChanged,
  signInWithCredential,
  User,
  signOut as firebaseSignOut,
} from 'firebase/auth';
import { createContext, useContext, useEffect, useState } from 'react';
import { firebaseAuth } from '../firebase';

type Auth = {
  user: User | null;
  loading: boolean;
  googleSignIn: () => Promise<boolean>;
};

const AuthContext = createContext<Auth>({} as Auth);

export const useAuthContext = () => {
  return useContext(AuthContext);
};

const useAuthProvider = () => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // googlesignin„ÇíË°å„ÅÜÂ†¥Âêà„Å´ÂøÖÈ†à„ÅßÂëº„Å≥Âá∫„Åô„ÇÇ„ÅÆ
    GoogleSignin.configure({ webClientId: /* GoogleService-Info.plistÂÜÖ„Å´„ÅÇ„ÇãCLIENT_ID> */  });
  }, []);

  // Google „ÅÆË™çË®ºÂøúÁ≠î„Åã„Çâ„ÅÆ ID „Éà„Éº„ÇØ„É≥„Çí Firebase Ë™çË®ºÊÉÖÂ†±„Å®‰∫§Êèõ„Åó„ÄÅ„Åù„Çå„Çí‰ΩøÁî®„Åó„Å¶ Firebase „Åß„ÅÆË™çË®º„ÇíË°å„ÅÜ
  const handleCredentialResponse = async (googleIdToken: string) => {
    const credential = GoogleAuthProvider.credential(googleIdToken);

    const result = await signInWithCredential(firebaseAuth, credential);
    if (result) {
      setUser(currentUser);
    }
  };

  const googleSignIn = async (): Promise<boolean> => {
    setLoading(true);
    try {
      await GoogleSignin.hasPlayServices();
      const userInfo = await GoogleSignin.signIn();
      if (userInfo) {
        await handleCredentialResponse(userInfo.idToken!);
      }

      setLoading(false);
      return true;
    } catch {
      setLoading(false);
      return false;
    }
  };

  return {
    user,
    loading,
    googleSignIn,
  };
}

export const AuthProvider: React.FC = ({ children }) => {
  const authContext = useAuthProvider();

  return <AuthContext.Provider value={authContext}>{children}</AuthContext.Provider>;
};
```

AuthProvider „Åß wrap „Åô„Çã

```tsx: App.tsx
import React from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { AuthProvider } from './src/hooks/auth';

export default function App() {
  return (
    <NavigationContainer>
      <AuthProvider>
        <RootStack>
      </AuthProvider>
    </NavigationContainer>
  );
}
```

# „É≠„Ç∞„Ç§„É≥Áä∂ÊÖã„ÅÆÁõ£Ë¶ñ

ÂâçËø∞„Åß‰Ωú„Å£„Åü„Ç´„Çπ„Çø„É†„Éï„ÉÉ„ÇØ„Çπ„Å´ onAuthStateChanged „Çí‰Ωø„Å£„Å¶„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„Å´ setUser „ÇíÂà©Áî®„Åó„Å¶„É¶„Éº„Ç∂ÊÉÖÂ†±„Çí‰øùÂ≠ò„Åó„Åæ„Åô„ÄÇ„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„Å´„ÅØ user ÊÉÖÂ†±„ÇíÁ©∫„Å´„Åó„Åæ„Åô„ÄÇ

```tsx:src/hooks/auth.tsx
...
  const useAuthProvider = () => {
  ...

  const handleRedirect = async () => {
    // googleÂÅ¥„Å´„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Çã„É¶„Éº„Ç∂„Éº„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó„Åô„Çã
    const userInfo = await GoogleSignin.signInSilently();

    if (userInfo) {
      await handleCredentialResponse(userInfo.idToken!);
    }
  };

  useEffect(() => {
    handleRedirect();

    const unsubscribe = onAuthStateChanged(firebaseAuth, (currentUser) => {
      if (currentUser) {
        onSuccess(currentUser);
      } else {
        setUser(null);
      }
      setLoading(false);
      unsubscribe();
    });
  }, [setUser]);
}
...
```

„Ç´„Çπ„Çø„É†„Éï„ÉÉ„ÇØ„Çπ„ÅÆ`auth.tsx`„ÅÆÂÆåÂÖ®Áâà

```tsx:src/hooks/auth.tsx
import { GoogleSignin } from '@react-native-google-signin/google-signin';
import {
  GoogleAuthProvider,
  onAuthStateChanged,
  signInWithCredential,
  User,
  signOut as firebaseSignOut,
} from 'firebase/auth';
import { createContext, useContext, useEffect, useState } from 'react';
import { firebaseAuth } from '../firebase';

type Auth = {
  user: User | null;
  loading: boolean;
  googleSignIn: () => Promise<boolean>;
};

const AuthContext = createContext<Auth>({} as Auth);

export const useAuthContext = () => {
  return useContext(AuthContext);
};

const useAuthProvider = () => {
  const [user, setUser] = useState<User | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // googlesignin„ÇíË°å„ÅÜÂ†¥Âêà„Å´ÂøÖÈ†à„ÅßÂëº„Å≥Âá∫„Åô„ÇÇ„ÅÆ
    GoogleSignin.configure({ webClientId: /* GoogleService-Info.plistÂÜÖ„Å´„ÅÇ„ÇãCLIENT_ID> */  });
  }, []);

  // Google „ÅÆË™çË®ºÂøúÁ≠î„Åã„Çâ„ÅÆ ID „Éà„Éº„ÇØ„É≥„Çí Firebase Ë™çË®ºÊÉÖÂ†±„Å®‰∫§Êèõ„Åó„ÄÅ„Åù„Çå„Çí‰ΩøÁî®„Åó„Å¶ Firebase „Åß„ÅÆË™çË®º„ÇíË°å„ÅÜ
  const handleCredentialResponse = async (googleIdToken: string) => {
    const credential = GoogleAuthProvider.credential(googleIdToken);

    const result = await signInWithCredential(firebaseAuth, credential);
    if (result) {
      setUser(currentUser);
    }
  };

  const handleRedirect = async () => {
    // googleÂÅ¥„Å´„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Çã„É¶„Éº„Ç∂„Éº„ÅÆÊÉÖÂ†±„ÇíÂèñÂæó„Åô„Çã
    const userInfo = await GoogleSignin.signInSilently();

    if (userInfo) {
      await handleCredentialResponse(userInfo.idToken!);
    }
  };

  useEffect(() => {
    handleRedirect();

    const unsubscribe = onAuthStateChanged(firebaseAuth, (currentUser) => {
        if (currentUser) {
          onSuccess(currentUser);
        } else {
          setUser(null);
        }
        setLoading(false);
        unsubscribe();
      });
    }, [setUser]);
  }

  const googleSignIn = async (): Promise<boolean> => {
    setLoading(true);
    try {
      await GoogleSignin.hasPlayServices();
      const userInfo = await GoogleSignin.signIn();
      if (userInfo) {
        await handleCredentialResponse(userInfo.idToken!);
      }

      setLoading(false);
      return true;
    } catch {
      setLoading(false);
      return false;
    }
  };

  return {
    user,
    loading,
    googleSignIn,
  };
  }

export const AuthProvider: React.FC = ({ children }) => {
  const authContext = useAuthProvider();

  return <AuthContext.Provider value={authContext}>{children}</AuthContext.Provider>;
};
```

user „Å´„É¶„Éº„Ç∂ÊÉÖÂ†±„Åå‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Çã„Åã„Å©„ÅÜ„Åã„ÅÆÊù°‰ª∂ÂàÜÂ≤ê„ÇíÂà©Áî®„Åó„Å¶„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ Home ÁîªÈù¢„ÄÅ„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Å™„ÅÑÂ†¥Âêà„ÅØ„É≠„Ç∞„Ç§„É≥ÁîªÈù¢„ÅåË°®Á§∫„Åï„Çå„Çã„Çà„ÅÜ„Å´„Åó„Åæ„Åô„ÄÇ

```tsx: RootStack.tsx
import React, { useEffect } from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import HomeScreen from './screens/HomeScreen';
import RegisterScreen from './screens/RegisterScreen';
import { onAuthStateChanged } from 'firebase/auth';
import { auth } from './firebase';
import { useAuthContext } from '../hooks/auth';

const Stack = createNativeStackNavigator();

export const RootStack = () => {
  const { user } = useAuthContext();

  return (
    <Stack.Navigator>
      {user ? (
        <Stack.Screen name="Home" component={HomeScreen} />
      ) : (
        <Stack.Screen name="login" component={LoginScreen} />
      )}
    </Stack.Navigator>
  );
}
```

# ÊúÄÂæå„Å´
„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅßÂÆüË£Ö„Åó„Åü„Ç≥„Éº„Éâ„ÅÆ‰∏ÄÈÉ®„ÇíÊäúÁ≤ã„Åó„Å¶Á¥π‰ªã„Åó„Å¶„ÅÑ„Çã„ÅÆ„Åß„ÄÅ‰∏ÄÈÉ®typo„Åß„ÅÇ„Å£„Åü„Çä„ÄÅ„ÅÜ„Åæ„ÅèÂãï„Åã„Å™„ÅÑ„Å®„Åì„Çç„Åå„ÅÇ„Çã„Åã„ÇÇ„Åó„Çå„Åæ„Åõ„Çì„Åå„ÄÅÂ∞ë„Åó„Åß„ÇÇÂèÇËÄÉ„Å´„Å™„Çå„Åü„Çâ„ÅÇ„Çä„Åå„Åü„ÅÑ„Åß„Åô„ÄÇ

# ÂèÇËÄÉ„Å´„Åó„ÅüË®ò‰∫ã

https://docs.expo.dev/versions/latest/sdk/google-sign-in/

https://github.com/react-native-google-signin/google-signin#expo-installation

https://ja.reactjs.org/docs/context.html